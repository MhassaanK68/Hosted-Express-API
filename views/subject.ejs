<%- include('partials/header') %>

  <main class="container mx-auto px-4 py-8">
    <!-- Breadcrumb -->
    <nav aria-label="Breadcrumb" class="flex flex-wrap items-center space-x-2 text-sm text-gray-500 mb-8">
      <a href="/" class="hover:text-blue-600 flex items-center gap-1">
        <i data-lucide="home" class="w-4 h-4"></i> Home
      </a>
      <i data-lucide="chevron-right" class="w-4 h-4"></i>
      <a href="/u/<%= semester.slug %>" class="hover:text-blue-600"><%= semester.name %></a>
      <i data-lucide="chevron-right" class="w-4 h-4"></i>
      <span class="font-medium text-gray-900 breadcrumb-item"><%= subject.name %></span>
    </nav>

    <!-- Subject Title -->
    <div class="mb-8">
      <h1 class="text-3xl sm:text-4xl font-bold tracking-tight color-primary">
        <%= subject.name %>
      </h1>
      <p class="mt-2 text-lg text-gray-600">Select a chapter to view course materials.</p>
    </div>

    <!-- Search -->
    <div class="mb-8 max-w-lg">
      <div class="relative">
        <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"></i>
        <input
          id="searchInput"
          type="search"
          placeholder="Search for a chapter..."
          class="w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>
    </div>

    <!-- Chapters Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">

      <% notes.forEach(note => { %>
        <!-- Chapter Card -->
        <div class="chapter-card rounded-lg border bg-white shadow-sm flex flex-col transition hover:shadow-lg hover:border-blue-400 hover:-translate-y-1 duration-200">
          <div class="flex-grow p-6">
            <h2 class="chapter-title text-lg font-semibold text-gray-900"><%= note.title %></h2>
            <div class="flex items-center gap-4 pt-2">
              <span class="flex items-center gap-1 text-xs text-gray-500">
                <i data-lucide="video" class="w-4 h-4 text-blue-500"></i> Videos
              </span>
              <span class="flex items-center gap-1 text-xs text-gray-500">
                <i data-lucide="file-text" class="w-4 h-4 text-blue-500"></i> Notes
              </span>
            </div>
          </div>
          <div class="flex flex-col items-stretch space-y-2 p-6 border-t">
            <% if(note.video_id){ %>
              <a href="https://youtube.com/watch?v=<%= note.video_id%>" target="_blank" class="inline-flex items-center justify-center px-3 py-2 text-sm font-medium rounded-md bg-blue-600 text-white hover:bg-blue-700">
                <i data-lucide="external-link" class="mr-2 h-4 w-4"></i>
                Watch Videos
              </a>
            <% } %>
            <% if(note.pdf_id){ %>
            <a href="/view-notes?id=<%= note.pdf_id %>" target="_blank" class="inline-flex items-center justify-center px-3 py-2 text-sm font-medium rounded-md border bg-gray-100 text-gray-700 hover:bg-gray-200">
              <i data-lucide="file-text" class="mr-2 h-4 w-4"></i>
              View Notes
            </a>
            <% } %>
            <% if(!note.pdf_id && !note.video_id){ %>
              <a disabled class="inline-flex items-center justify-center px-3 py-2 text-sm font-medium rounded-md border bg-gray-100 text-gray-700 hover:bg-gray-200">
                <i data-lucide="file-text" class="mr-2 h-4 w-4"></i>
                No Resources Available
              </a>
            <% } %>
          </div>
        </div>

      <%});%>


    </div>


    <div id="noResults" class="hidden col-span-full text-center py-16 border-2 border-dashed rounded-lg">
      <h3 class="text-xl font-semibold text-gray-900">Nothing Here!</h3>
      <p class="text-gray-500 mt-2">Lazy admins are slacking, check back later.</p>
    </div>

  </main>

  
  <script>
    lucide.createIcons();

    const searchInput = document.getElementById("searchInput");
    const chapters = document.querySelectorAll(".chapter-card");
    const noResults = document.getElementById("noResults");

    if (chapters.length == 0){
      noResults.classList.remove("hidden");
    }


    searchInput.addEventListener("input", () => {
      const query = searchInput.value.toLowerCase().trim();
      let visibleCount = 0;

      chapters.forEach(card => {
        const title = card.querySelector(".chapter-title").textContent.toLowerCase();
        if (title.includes(query)) {
          card.classList.remove("hidden");
          visibleCount++;
        } else {
          card.classList.add("hidden");
        }
      });

      noResults.classList.toggle("hidden", visibleCount > 0);
    });
  </script>


<%- include('partials/footer') %>